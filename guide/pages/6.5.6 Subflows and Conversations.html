<html>
     <head>
     	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
     	<title>6.5.6 Subflows and Conversations</title>
     	<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8">
     </head>
	<body class="body">
		Grails의 웹 플로우는 서브플로우를 지원한다. 서브플로우는 플로우안에 있는 플로우를 말한다. 검색 플로우의 예를 보면:<p class="paragraph"/><div class="code"><pre>def searchFlow = &#123;
            displaySearchForm &#123;
                on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"executeSearch"</span>
            &#125;
            executeSearch &#123;
                action &#123;
                    &#91;results:searchService.executeSearch(params.q)&#93;
                &#125;
                on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"displayResults"</span>
                on(<span class="java&#45;quote">"error"</span>).to <span class="java&#45;quote">"displaySearchForm"</span>
            &#125;
            displayResults &#123;
                on(<span class="java&#45;quote">"searchDeeper"</span>).to <span class="java&#45;quote">"extendedSearch"</span>
                on(<span class="java&#45;quote">"searchAgain"</span>).to <span class="java&#45;quote">"displaySearchForm"</span>
            &#125;
            extendedSearch &#123;
                subflow(extendedSearchFlow)   // &#60;&#45;&#45;&#45; 확장된 검색 서브플로우
                on(<span class="java&#45;quote">"moreResults"</span>).to <span class="java&#45;quote">"displayMoreResults"</span>
                on(<span class="java&#45;quote">"noResults"</span>).to <span class="java&#45;quote">"displayNoMoreResults"</span>
            &#125;
            displayMoreResults()
            displayNoMoreResults()
&#125;</pre></div><p class="paragraph"/>이 것은 extendedSearch 상태에 있는 서브플로우를 참조한다. 서브플로우는 다른 플로우와 완전히 동일하다:<p class="paragraph"/><div class="code"><pre>def extendedSearchFlow = &#123;
       startExtendedSearch &#123;
           on(<span class="java&#45;quote">"findMore"</span>).to <span class="java&#45;quote">"searchMore"</span>
           on(<span class="java&#45;quote">"searchAgain"</span>).to <span class="java&#45;quote">"noResults"</span>
       &#125;
       searchMore &#123;
           action &#123;
              def results = searchService.deepSearch(ctx.conversation.query)
              <span class="java&#45;keyword">if</span>(!results)<span class="java&#45;keyword">return</span> error()
              conversation.extendedResults = results
           &#125;
           on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"moreResults"</span>
           on(<span class="java&#45;quote">"error"</span>).to <span class="java&#45;quote">"noResults"</span>
       &#125;
       moreResults()
       noResults()
&#125;</pre></div><p class="paragraph"/>extendedResults가 conversation 스콥에 어떻게 저장되는지 살펴보자. 이 스콥는 conversation 전체에 걸친 모든 상태에 공유되므로 flow 스콥와 다르다. 서브플로우의 끝 상태인 noResults와 moreResults는 이벤트를 주 플로우에 발생킨다:<p class="paragraph"/><div class="code"><pre>extendedSearch &#123;
         subflow(extendedSearchFlow)   // &#60;&#45;&#45;&#45; extended search subflow
         on(<span class="java&#45;quote">"moreResults"</span>).to <span class="java&#45;quote">"displayMoreResults"</span>
         on(<span class="java&#45;quote">"noResults"</span>).to <span class="java&#45;quote">"displayNoMoreResults"</span>
&#125;</pre></div><p class="paragraph"/>
	</body>
</html>