<html>
     <head>
     	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
     	<title>3.1.2 Logging</title>
     	<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8">
     </head>
	<body class="body">
		<h4>Logging Basics</h4><p class="paragraph"/>Grails는 <a href="http://logging.apache.org/log4j/1.2/index.html" target="blank">Log4j</a> 로그 시스템에 기반한 공통의 '설정 매커니즘'을 사용한다. <code>grails-app/conf</code> 디렉토리에 있는 <code>Config.groovy</code>를 수정하여 로깅을 설정하고 <code>Config.groovy</code>파일 하나로 <code>development</code>, <code>test</code>, <code>production</code>의 각 환경에 맞게 로깅 구성을 따로 정할 수 있다. Grails는 <code>Config.groovy</code>파일을 처리해서 <code>web-app/WEB-INF/classes</code> 디렉토리 안에 알맞은 <code>log4j.properties</code> 파일을 생성한다.<p class="paragraph"/>Grails의 일반적인 Log4j 설정은 다음과 같다:<p class="paragraph"/><div class="code"><pre>log4j &#123;
    appender.stdout = <span class="java&#45;quote">"org.apache.log4j.ConsoleAppender"</span>
	appender.'stdout.layout'=<span class="java&#45;quote">"org.apache.log4j.PatternLayout"</span>
    rootLogger=<span class="java&#45;quote">"error,stdout"</span>
    logger &#123;
        grails=<span class="java&#45;quote">"info,stdout"</span>
        org &#123;
            grails.spring=<span class="java&#45;quote">"info,stdout"</span>
            codehaus.groovy.grails.web=<span class="java&#45;quote">"info,stdout"</span>
            codehaus.groovy.grails.commons=<span class="java&#45;quote">"info,stdout"</span>
            &#8230;
        &#125;
&#125;
&#125;</pre></div><p class="paragraph"/>표준 Log4j 프로퍼티 파일 스타일을 선호한다면 groovy 멀티라인 문자열을 사용할 수 있다:<p class="paragraph"/><div class="code"><pre>log4j = '''
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
&#35; ...remaining configuration
'''</pre></div><p class="paragraph"/>여기에 유용한 logger를 소개한다:
<ul class="star">
<li>org.codehaus.groovy.grails.commons - 클래스 로딩과 같은 중요한 정보</li>
<li>org.codehaus.groovy.grails.web - Grails의 웹 요청 처리</li>
<li>org.codehaus.groovy.grails.web.mapping - URL 매핑 디버깅</li>
<li>org.codehaus.groovy.grails.plugins - 로그 플러그인의 행동</li>
<li>org.springframework - Spring이 하는 일</li>
<li>org.hibernate - Hibernate가 하는 일</li>
</ul><p class="paragraph"/><h4>Full stacktraces</h4><p class="paragraph"/>예외가 발생 했을 때 자바와 Groovy 내부에서부터 스택을 트레이스하면 심한 노이즈가 있을 수 있다. Grails는 보통 관련이 없는 것들을 걸러내고 중요하지 않은 Grails/Groovy 클래스 패키지만을 Trace하도록 제한한다. Grails는 보통 그러한 관련이 없는 것들을 필터링 해주고, 핵심 Grails/Groovy 클래스 패키지가 아닌 것으로 Trace를 제한하고 있다.<p class="paragraph"/>예외가 발생하면, 전체 추적 내용은 항상 StackTrace 로거에 씌여진다. StackTrace는 <code>stacktrace.log</code> 파일에 기록하지만 Congfig.groovy파일을 이용해서 원하는 곳에 기록하도록 할 수 있다. 예를 들어 만약에 표준 출력으로 전체 추적 내용을 기록하고 싶다면 다음과 같은 설정을:<p class="paragraph"/><div class="code"><pre>StackTrace=<span class="java&#45;quote">"error,errors"</span></pre></div><p class="paragraph"/>다음과 같이 바꾼다:<p class="paragraph"/><div class="code"><pre>StackTrace=<span class="java&#45;quote">"error,stdout"</span></pre></div><p class="paragraph"/><code>grails.full.stacktrace</code> VM 프로퍼티을 <code>true</code>로 설정을 해서 스택 트레이스 필터링을 끌 수 있다.<p class="paragraph"/><div class="code"><pre>grails &#45;Dgrails.full.stacktrace=<span class="java&#45;keyword">true</span> run&#45;app</pre></div><p class="paragraph"/><h4>Logging by Convention</h4><p class="paragraph"/>어플리케이션의 모든 아티펙트에는 <code>log</code> 프로퍼티을 동적으로 추가할 수 있다. 아티펙트는 <a href="../guide/single.html#5. Object Relational Mapping (GORM)" class="guide">도메인 클래스</a>, <a href="../guide/single.html#6.1 Controllers" class="guide">컨트롤러</a>, 태그 라이브러리 등을 말한다. 이것의 사용법은 다음과 같다:<p class="paragraph"/><div class="code"><pre>def foo = <span class="java&#45;quote">"bar"</span>
log.debug <span class="java&#45;quote">"The value of foo is $foo"</span></pre></div><p class="paragraph"/>로그의 이름은 <code>grails.app.&#60;아티펙트 타입&#62;.ClassName</code> 과 같은 관례에 따른다. 다음은 다양한 Grails 아티펙트에 로그를 설정하는 예이다:<p class="paragraph"/><div class="code"><pre>&#35; Set level <span class="java&#45;keyword">for</span> all application artefacts
log4j.logger.grails.app=<span class="java&#45;quote">"info, stdout"</span><p class="paragraph"/>&#35; Set <span class="java&#45;keyword">for</span> a specific controller
log4j.logger.grails.app.controller.YourController=<span class="java&#45;quote">"debug, stdout"</span><p class="paragraph"/>&#35; Set <span class="java&#45;keyword">for</span> a specific domain class
log4j.logger.grails.app.domain.Book=<span class="java&#45;quote">"debug, stdout"</span><p class="paragraph"/>&#35; Set <span class="java&#45;keyword">for</span> a specific taglib
log4j.logger.grails.app.tagLib.FancyAjax=<span class="java&#45;quote">"debug, stdout"</span><p class="paragraph"/>&#35; Set <span class="java&#45;keyword">for</span> all taglibs
log4j.logger.grails.app.tagLib=<span class="java&#45;quote">"info, stdout"</span></pre></div><p class="paragraph"/>아티펙트들의 이름은 관례에 따른다. 다음은 일반적인 아티펙트들의 목록이다.
<ul class="star">
<li>bootstrap - 부트스트랩 클래스들을 위한 아티펙트</li>
<li>dataSource - data source들을 위한 아티펙트</li>
<li>tagLib - 태그 라이브러리를 위한 아티펙트</li>
<li>service - 서비스 클래스들을 위한 아티펙트</li>
<li>controller - 컨트롤러들을 위한 아티펙트</li>
<li>domain - 도메인 요소들을 위한 아티펙트</li>
</ul><p class="paragraph"/>
	</body>
</html>